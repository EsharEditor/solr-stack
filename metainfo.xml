<?xml version="1.0"?>
<metainfo>
  <schemaVersion>2.0</schemaVersion>
  <services>
    <service>
      <!-- Internal name for service (must be unique) -->
      <name>SOLR</name>
      <!-- display name for service (displayed in Ambari UI) -->
      <displayName>Solr</displayName>
      <!-- Description of service - will be displayed when user clicks add 
        service -->
      <comment>Solr is a search platform from the Apache Lucene project.
        Its major features include full-text search, hit highlighting,
        faceted search, dynamic clustering, database integration, and
        rich document (e.g., Word, PDF) handling.
      </comment>
      <!-- Version of component -->
      <version>5.2.0</version>

      <components>
        <!-- In this case, there is only one master component -->
        <component>
          <name>SOLR_MASTER</name>
          <displayName>Solr</displayName>
          <category>MASTER</category>
          <!-- how many of these components are allowed in a cluster e.g. 
            1 or 1+ -->
          <cardinality>1+</cardinality>
          <versionAdvertised>true</versionAdvertised>
          <dependencies>
            <dependency>
              <name>ZOOKEEPER/ZOOKEEPER_SERVER</name>
              <scope>cluster</scope>
              <auto-deploy>
                <enabled>true</enabled>
                <co-locate>SOLR/SOLR_MASTER</co-locate>
              </auto-deploy>
            </dependency>
          </dependencies>
          <!-- reference to and details of what script is to be used to install/stop/start/config 
            the service -->
          <commandScript>
            <script>scripts/master.py</script>
            <scriptType>PYTHON</scriptType>
            <timeout>5000</timeout>
          </commandScript>
        </component>
      </components>
      <!-- what yum packages will be needed for the setup. These will be 
        installed by install_packages() in master.py -->
      <osSpecifics>
        <osSpecific>
          <osFamily>redhat6</osFamily>
          <packages>
            <package>
              <name>wget</name>
            </package>
            <package>
              <name>tar</name>
            </package>
          </packages>
        </osSpecific>
      </osSpecifics>

      <commandScript>
        <script>scripts/service_check.py</script>
        <scriptType>PYTHON</scriptType>
        <timeout>300</timeout>
      </commandScript>

      <requiredServices>
        <service>HDFS</service>
        <service>ZOOKEEPER</service>
      </requiredServices>

      <!-- names for config files (under configuration dir) -->
      <configuration-dependencies>
        <config-type>solr-config</config-type>
        <config-type>solr-cloud</config-type>
        <config-type>solr-ssl</config-type>
      </configuration-dependencies>
      <restartRequiredAfterChange>false</restartRequiredAfterChange>
    </service>
  </services>
</metainfo>
